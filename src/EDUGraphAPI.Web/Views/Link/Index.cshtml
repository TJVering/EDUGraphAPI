@model UserContext
@{
    ViewBag.Title = "User";
    var message = TempData["Message"] as string;
}

<h2>Link Accounts Page</h2>

@if (!Model.AreAccountsLinked)
{
    if (Model.IsLocalAccount)
    {
        <div class="form-horizontal" id="linkAccountPrompt">
            <hr />
            @using (Html.BeginForm("LoginO365", null, FormMethod.Post, null))
            {
                @Html.AntiForgeryToken()
                @Html.ValidationSummary(true)
                <p><input type="submit" value="Use Existing O365 account" class="btn btn-primary" /> 
            &nbsp; &nbsp;
            <input id="skipLinkAccount" class="btn btn-primary" value="Cancel"/></p>
                
            }
        </div>
    }
    else
    {
       <hr />
        <div class="form-horizontal">
             <p>@Html.ActionLink("Use Existing Local Account", "LoginLocal", null, new { @class = "btn btn-primary" }) &nbsp; &nbsp;
             @Html.ActionLink("Create Local Account", "CreateLocalAccount", null, new { @class = "btn btn-primary" }) &nbsp; &nbsp;
            @Html.ActionLink("Cancel","index", "Schools",null, new { @class = "btn btn-primary" })</p>

        </div>
    }
}
else
{
    <div>
        <p>Your local account and Office 365 account are now linked.</p>
        <p>
            <ul>
                <li>Local account: @Model.User.Email</li>
                <li>Office 365 account: @Model.User.O365Email</li>
            </ul>
        </p>
        <p>@Html.ActionLink("Return to home", "Index", "Home", null, new { @class = "btn btn-default" })</p>
    </div>
}

@helper LocalLoginForm()
{
}
@section scripts{
    <script type="text/javascript">
        $(function () {
            $('#skipLinkAccount').on('click', function () {
                $('#linkAccountPrompt').hide();
            });
        });
    </script>
}